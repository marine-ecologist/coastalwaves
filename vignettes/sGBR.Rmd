---
title: "3. Far Northern GBR"
author: "George Roff"
date: "2025-09-24"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
```{r eval=TRUE, message=FALSE, warning=FALSE, include=FALSE, echo=FALSE}
library(devtools)

load_all()
conflicted::conflicts_prefer(dplyr::filter)
```

Example from the southern Northern GBR

```{r fig.height=9, fig.width=7, message=FALSE, warning=FALSE, cache=TRUE}


library(oceanwaves)
library(dhw)
library(sf)
library(tidyverse)
library(lubridate)
library(ggplot2)


### download GBR shape file
gbr_shape <- download_gbr_spatial(return = "base") |>
  select(LOC_NAME_S, X_COORD, Y_COORD) |> 
  st_make_valid() |> 
  st_transform(20353)

### Grep subset for target reefs, create union
fn_capricorn <- gbr_shape |> 
  filter(grepl("23-052|23-053", LOC_NAME_S))

fn_capricorn_union <- fn_capricorn |>
  st_union() |>
  st_boundary() |>
  st_cast("LINESTRING")

# Extract broader region
fn_capricorn_region <- st_crop(gbr_shape, 
                             fn_capricorn_union |>
                                st_union() |> 
                                st_centroid() |> 
                                st_buffer(20000))

# get points
fn_capricorn_points <- calculate_points(fn_capricorn_union, 100)


### calculate fetch
fn_capricorn_fetch <- calculate_fetch(point = fn_capricorn_points, 
                                     degrees = 7.5, 
                                     fetch = 5000, 
                                     land = fn_capricorn_region, 
                                     parallel = TRUE, 
                                     cores = 8)


### get wind data
fn_capricorn_wind <- get_wind_data(fn_capricorn, "1997-01-01", "1997-12-31")


### get waves
fn_capricorn_waves <- calculate_waves(wind = fn_capricorn_wind, 
                                     fetch = fn_capricorn_fetch, 
                                     points = fn_capricorn_points, 
                                     parallel = TRUE, 
                                     cores = 8) 

library(tmap) 
tmap_mode("view") +
tm_basemap("Esri.WorldImagery") +
tm_shape(fn_capricorn_waves) +
  tm_dots(fill="wave_energy", shape=21, size=0.8,
          fill.scale=tm_scale_continuous(values="-brewer.spectral"))


```
